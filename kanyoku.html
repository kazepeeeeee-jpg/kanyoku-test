<!DOCTYPE html>  
<html lang="ja">  
<head>  
<meta charset="UTF-8">  
<title>小4 国語 慣用句 学習アプリ（完成版）</title>  
<style>  
body { font-family: Meiryo,sans-serif; background:#f4f6f8; padding:20px;}  
.panel { background:#fff; padding:15px; max-width:720px; margin:15px auto; border-radius:8px;}  
h1,h2{text-align:center;}  
button{padding:8px 14px; margin-top:8px;}  
.choice{display:block; margin:6px 0;}  
.hidden{display:none;}  
.correct{color:green;}  
.wrong{color:red;}  
.timer{font-size:20px; text-align:center; color:#d9534f;}  
</style>  
</head>  
<body>  
  
<h1>小4 国語 慣用句 学習アプリ</h1>  
  
<div class="panel">  
名前：<input id="playerName"><br><br>  
  
問題数：  
<select id="qCount">  
  <option>10</option><option>20</option><option>30</option>  
  <option>40</option><option>50</option>  
</select><br><br>  
  
モード：  
<select id="mode">  
  <option value="normal">通常</option>  
  <option value="time">制限時間</option>  
  <option value="survival">50問サバイバル</option>  
</select><br><br>  
  
<button onclick="startQuiz()">スタート</button>  
</div>  
  
<div id="timer" class="timer hidden"></div>  
  
<div id="quizPanel" class="panel hidden">  
<h2 id="qText"></h2>  
<div id="choices"></div>  
<div id="result"></div>  
<button onclick="nextQuestion()">つぎへ</button>  
</div>  
  
<div id="scorePanel" class="panel hidden">  
<h2>成績</h2>  
<p id="scoreText"></p>  
</div>  
  
<script>  
let questions = JSON.parse(localStorage.getItem("kanyokuQ")) || [  
 {phrase:"頭がいい",meaning:"考える力がすぐれている",type:"choice"},  
 {phrase:"口がかたい",meaning:"ひみつを人に話さない",type:"write"},  
 {phrase:"目を通す",meaning:"さっと読む",type:"choice"},  
 {phrase:"手をあげる",meaning:"こうさんする",type:"write"}  
];  
  
let quiz=[],idx=0,correct=0,mode="",timerInt,timeLeft=0;  
  
function startQuiz(){  
 mode=document.getElementById("mode").value;  
 let count = mode==="survival"?50:Number(qCount.value);  
 quiz=shuffle([...questions]).slice(0,count);  
 idx=0; correct=0;  
 document.getElementById("quizPanel").classList.remove("hidden");  
 document.getElementById("scorePanel").classList.add("hidden");  
 startTimer();  
 nextQuestion();  
}  
  
function startTimer(){  
 clearInterval(timerInt);  
 if(mode==="time"){  
  timeLeft=quiz.length*30;  
  timer.classList.remove("hidden");  
  timerInt=setInterval(()=>{  
    timer.textContent="残り時間："+timeLeft+"秒";  
    if(timeLeft--<=0) endQuiz();  
  },1000);  
 }else{  
  timer.classList.add("hidden");  
 }  
}  
  
function nextQuestion(){  
 document.getElementById("result").textContent="";  
 if(idx>=quiz.length){ endQuiz(); return;}  
 let q=quiz[idx];  
 qText.textContent=`「${q.phrase}」の意味は？`;  
 choices.innerHTML="";  
 if(q.type==="choice"){  
  let opts=shuffle([q.meaning,...shuffle(questions.map(x=>x.meaning)).slice(0,3)]);  
  opts.forEach(o=>{  
    let b=document.createElement("button");  
    b.className="choice";  
    b.textContent=o;  
    b.onclick=()=>judge(o,q.meaning);  
    choices.appendChild(b);  
  });  
 }else{  
  let i=document.createElement("input");  
  let b=document.createElement("button");  
  b.textContent="答える";  
  b.onclick=()=>judge(i.value,q.meaning);  
  choices.append(i,b);  
 }  
}  
  
function judge(ans,cor){  
 let r=result;  
 if(ans.trim()===cor){  
  r.textContent="⭕ 正解"; r.className="correct"; correct++; idx++;  
 }else{  
  r.textContent="❌ ちがう"; r.className="wrong";  
  if(mode==="survival"){ endQuiz(); return;}  
  idx++;  
 }  
}  
  
function endQuiz(){  
 clearInterval(timerInt);  
 quizPanel.classList.add("hidden");  
 scorePanel.classList.remove("hidden");  
 let rate=Math.round(correct/idx*100||0);  
 scoreText.textContent=  
  `正答数：${correct} / ${idx}　正答率：${rate}%`;  
}  
  
function shuffle(a){return a.sort(()=>Math.random()-0.5);}  
</script>  
  
</body>  
</html>  
